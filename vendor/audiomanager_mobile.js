(function(root,factory){if(typeof module!=="undefined"&&module.exports){module.exports=factory()}else{root.AudioManager=factory()}})(this,function(){var requirejs,require,define;(function(undef){var main,req,makeMap,handlers,defined={},waiting={},config={},defining={},hasOwn=Object.prototype.hasOwnProperty,aps=[].slice;function hasProp(obj,prop){return hasOwn.call(obj,prop)}function normalize(name,baseName){var nameParts,nameSegment,mapValue,foundMap,foundI,foundStarMap,starI,i,j,part,baseParts=baseName&&baseName.split("/"),map=config.map,starMap=map&&map["*"]||{};if(name&&name.charAt(0)==="."){if(baseName){baseParts=baseParts.slice(0,baseParts.length-1);name=baseParts.concat(name.split("/"));for(i=0;i<name.length;i+=1){part=name[i];if(part==="."){name.splice(i,1);i-=1}else if(part===".."){if(i===1&&(name[2]===".."||name[0]==="..")){break}else if(i>0){name.splice(i-1,2);i-=2}}}name=name.join("/")}else if(name.indexOf("./")===0){name=name.substring(2)}}if((baseParts||starMap)&&map){nameParts=name.split("/");for(i=nameParts.length;i>0;i-=1){nameSegment=nameParts.slice(0,i).join("/");if(baseParts){for(j=baseParts.length;j>0;j-=1){mapValue=map[baseParts.slice(0,j).join("/")];if(mapValue){mapValue=mapValue[nameSegment];if(mapValue){foundMap=mapValue;foundI=i;break}}}}if(foundMap){break}if(!foundStarMap&&starMap&&starMap[nameSegment]){foundStarMap=starMap[nameSegment];starI=i}}if(!foundMap&&foundStarMap){foundMap=foundStarMap;foundI=starI}if(foundMap){nameParts.splice(0,foundI,foundMap);name=nameParts.join("/")}}return name}function makeRequire(relName,forceSync){return function(){return req.apply(undef,aps.call(arguments,0).concat([relName,forceSync]))}}function makeNormalize(relName){return function(name){return normalize(name,relName)}}function makeLoad(depName){return function(value){defined[depName]=value}}function callDep(name){if(hasProp(waiting,name)){var args=waiting[name];delete waiting[name];defining[name]=true;main.apply(undef,args)}if(!hasProp(defined,name)&&!hasProp(defining,name)){throw new Error("No "+name)}return defined[name]}function splitPrefix(name){var prefix,index=name?name.indexOf("!"):-1;if(index>-1){prefix=name.substring(0,index);name=name.substring(index+1,name.length)}return[prefix,name]}makeMap=function(name,relName){var plugin,parts=splitPrefix(name),prefix=parts[0];name=parts[1];if(prefix){prefix=normalize(prefix,relName);plugin=callDep(prefix)}if(prefix){if(plugin&&plugin.normalize){name=plugin.normalize(name,makeNormalize(relName))}else{name=normalize(name,relName)}}else{name=normalize(name,relName);parts=splitPrefix(name);prefix=parts[0];name=parts[1];if(prefix){plugin=callDep(prefix)}}return{f:prefix?prefix+"!"+name:name,n:name,pr:prefix,p:plugin}};function makeConfig(name){return function(){return config&&config.config&&config.config[name]||{}}}handlers={require:function(name){return makeRequire(name)},exports:function(name){var e=defined[name];if(typeof e!=="undefined"){return e}else{return defined[name]={}}},module:function(name){return{id:name,uri:"",exports:defined[name],config:makeConfig(name)}}};main=function(name,deps,callback,relName){var cjsModule,depName,ret,map,i,args=[],usingExports;relName=relName||name;if(typeof callback==="function"){deps=!deps.length&&callback.length?["require","exports","module"]:deps;for(i=0;i<deps.length;i+=1){map=makeMap(deps[i],relName);depName=map.f;if(depName==="require"){args[i]=handlers.require(name)}else if(depName==="exports"){args[i]=handlers.exports(name);usingExports=true}else if(depName==="module"){cjsModule=args[i]=handlers.module(name)}else if(hasProp(defined,depName)||hasProp(waiting,depName)||hasProp(defining,depName)){args[i]=callDep(depName)}else if(map.p){map.p.load(map.n,makeRequire(relName,true),makeLoad(depName),{});args[i]=defined[depName]}else{throw new Error(name+" missing "+depName)}}ret=callback.apply(defined[name],args);if(name){if(cjsModule&&cjsModule.exports!==undef&&cjsModule.exports!==defined[name]){defined[name]=cjsModule.exports}else if(ret!==undef||!usingExports){defined[name]=ret}}}else if(name){defined[name]=callback}};requirejs=require=req=function(deps,callback,relName,forceSync,alt){if(typeof deps==="string"){if(handlers[deps]){return handlers[deps](callback)}return callDep(makeMap(deps,callback).f)}else if(!deps.splice){config=deps;if(callback.splice){deps=callback;callback=relName;relName=null}else{deps=undef}}callback=callback||function(){};if(typeof relName==="function"){relName=forceSync;forceSync=alt}if(forceSync){main(undef,deps,callback,relName)}else{setTimeout(function(){main(undef,deps,callback,relName)},4)}return req};req.config=function(cfg){config=cfg;if(config.deps){req(config.deps,config.callback)}return req};define=function(name,deps,callback){if(!deps.splice){callback=deps;deps=[]}if(!hasProp(defined,name)&&!hasProp(waiting,name)){waiting[name]=[name,deps,callback]}};define.amd={jQuery:true}})();define("vendor/almond",function(){});!function(n){function t(n,t,e){if(!n||!S[typeof n])return n;t=t&&typeof e=="undefined"?t:f.createCallback(t,e);var r=n.length;if(e=-1,r&&c(n))for(;++e<r&&(e+="",false!==t(n[e],e,n)););else for(e in r=typeof n=="function",n)if((!r||"prototype"!=e)&&false===t(n[e],e,n))break;return n}function e(n,t,e){var r,o=n,u=o;if(!o)return u;var i=arguments,a=0,l=typeof e=="number"?2:i.length;if(3<l&&"function"==typeof i[l-2])var p=f.createCallback(i[--l-1],i[l--],2);else 2<l&&"function"==typeof i[l-1]&&(p=i[--l]);for(;++a<l;)if((o=i[a])&&S[typeof o]){var s=o.length;if(r=-1,s&&c(o))for(;++r<s;)r+="",u[r]=p?p(u[r],o[r]):o[r];else for(r in s=typeof o=="function",o)s&&"prototype"==r||!N.call(o,r)||(u[r]=p?p(u[r],o[r]):o[r])}return u}function r(n){var t,e=[];if(!n||!S[typeof n])return e;var r=n.length;if(t=-1,r&&c(n))for(;++t<r;)t+="",e.push(t);else for(t in r=typeof n=="function",n)r&&"prototype"==t||!N.call(n,t)||e.push(t);return e}function o(){}function u(n){n.length=0,b.length<j&&b.push(n)}function f(){}function i(n,t,e){function r(){var c=arguments,l=u?this:t;return o||(n=t[f]),e.length&&(c=c.length?(c=z.call(c),i?c.concat(e):e.concat(c)):e),this instanceof r?(l=a(n.prototype),c=n.apply(l,c),y(c)?c:l):n.apply(l,c)}var o=s(n),u=!e,f=t;if(u){var i=void 0;e=t}else if(!o)throw new TypeError;return r}function a(n){return y(n)?T(n):{}}function c(n){return q.call(n)==_}function l(n){var e=[];return t(n,function(n,t){s(n)&&e.push(t)}),e.sort()}function p(n,e,r,o,i,a){var c=r===m;if(typeof r=="function"&&!c){r=f.createCallback(r,o,2);var l=r(n,e);if(typeof l!="undefined")return!!l}if(n===e)return 0!==n||1/n==1/e;var y=typeof n,g=typeof e;if(n===n&&(!n||"function"!=y&&"object"!=y)&&(!e||"function"!=g&&"object"!=g))return!1;if(null==n||null==e)return n===e;if(g=q.call(n),y=q.call(e),g==_&&(g=O),y==_&&(y=O),g!=y)return!1;switch(g){case w:case A:return+n==+e;case k:return n!=+n?e!=+e:0==n?1/n==1/e:n==+e;case C:case x:return n==e+""}if(y=g==E,!y){if(N.call(n,"__wrapped__")||N.call(e,"__wrapped__"))return p(n.__wrapped__||n,e.__wrapped__||e,r,o,i,a);if(g!=O)return!1;var g=n.constructor,v=e.constructor;if(g!=v&&!(s(g)&&g instanceof g&&s(v)&&v instanceof v))return!1}for(v=!i,i||(i=b.pop()||[]),a||(a=b.pop()||[]),g=i.length;g--;)if(i[g]==n)return a[g]==e;var h=0,l=!0;if(i.push(n),a.push(e),y){if(g=n.length,h=e.length,l=h==n.length,!l&&!c)return l;for(;h--;)if(y=g,v=e[h],c)for(;y--&&!(l=p(n[y],v,r,o,i,a)););else if(!(l=p(n[h],v,r,o,i,a)))break;return l}return t(e,function(t,e,u){return N.call(u,e)?(h++,l=N.call(n,e)&&p(n[e],t,r,o,i,a)):void 0}),l&&!c&&t(n,function(n,t,e){return N.call(e,t)?l=-1<--h:void 0}),v&&(u(i),u(a)),l}function s(n){return typeof n=="function"}function y(n){return!(!n||!S[typeof n])}function g(n,t,e){if(t&&typeof e=="undefined"&&H(n)){e=-1;for(var r=n.length;++e<r&&false!==t(n[e],e,n););}else if(n)if(t=t&&typeof e=="undefined"?t:f.createCallback(t,e),r=n.length,e=-1,typeof r=="number")for(;++e<r&&false!==t(n[e],e,n););else for(e in r=typeof n=="function",n)if((!r||"prototype"!=e)&&N.call(n,e)&&false===t(n[e],e,n))break;return n}function v(n,t){return G.fastBind||M&&2<arguments.length?M.call.apply(M,arguments):i(n,t,z.call(arguments,2))}function h(n){return n}var b=[],d=0,m={},j=40,_="[object Arguments]",E="[object Array]",w="[object Boolean]",A="[object Date]",k="[object Number]",O="[object Object]",C="[object RegExp]",x="[object String]",S={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},I=S[typeof global]&&global;!I||I.global!==I&&I.window!==I||(n=I);var P=[],I=Error.prototype,B=Object.prototype,R=RegExp("^"+(B.valueOf+"").replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),$=P.concat,N=B.hasOwnProperty,F=B.propertyIsEnumerable,q=B.toString,M=R.test(M=q.bind)&&M,T=R.test(T=Object.create)&&T,D=R.test(D=Array.isArray)&&D,V=R.test(V=Object.keys)&&V,z=P.slice;n=R.test(n.attachEvent),n=M&&!/\n|true/.test(M+n);var G=f.support={};G.enumErrorProps=F.call(I,"message")||F.call(I,"name"),G.enumPrototypes=!0,G.fastBind=M&&!n,G.nonEnumArgs=!0,T||(a=function(n){if(y(n)){o.prototype=n;var t=new o;o.prototype=null}return t||{}});var H=D||function(n){return n?typeof n=="object"&&q.call(n)==E:!1},J=V?function(n){return y(n)?G.enumPrototypes&&typeof n=="function"||G.nonEnumArgs&&n.length&&c(n)?r(n):V(n):[]}:r;s(/x/)&&(s=function(n){return typeof n=="function"&&"[object Function]"==q.call(n)}),f.assign=e,f.bind=v,f.bindAll=function(n){for(var t=1<arguments.length?$.apply(P,z.call(arguments,1)):l(n),e=-1,r=t.length;++e<r;){var o=t[e];n[o]=v(n[o],n)}return n},f.createCallback=function(n,t,e){if(null==n)return h;var r=typeof n;if("function"!=r){if("object"!=r)return function(t){return t[n]};var o=J(n);return function(t){for(var e=o.length,r=!1;e--&&(r=p(t[o[e]],n[o[e]],m)););return r}}return typeof t=="undefined"?n:1===e?function(e){return n.call(t,e)}:2===e?function(e,r){return n.call(t,e,r)}:4===e?function(e,r,o,u){return n.call(t,e,r,o,u)}:function(e,r,o){return n.call(t,e,r,o)}},f.defaults=function(n,t,e){var r,o=n,u=o;if(!o)return u;for(var f=arguments,i=0,a=typeof e=="number"?2:f.length;++i<a;)if((o=f[i])&&S[typeof o]){var l=o.length;if(r=-1,l&&c(o))for(;++r<l;)r+="","undefined"==typeof u[r]&&(u[r]=o[r]);else for(r in l=typeof o=="function",o)l&&"prototype"==r||!N.call(o,r)||"undefined"==typeof u[r]&&(u[r]=o[r])}return u},f.forEach=g,f.forIn=t,f.functions=l,f.invoke=function(n,t){var e=z.call(arguments,2),r=-1,o=typeof t=="function",u=n?n.length:0,f=Array(typeof u=="number"?u:0);return g(n,function(n){f[++r]=(o?t:n[t]).apply(n,e)}),f},f.keys=J,f.once=function(n){var t,e;return function(){return t?e:(t=!0,e=n.apply(this,arguments),n=null,e)}},f.values=function(n){for(var t=-1,e=J(n),r=e.length,o=Array(r);++t<r;)o[t]=n[e[t]];return o},f.each=g,f.extend=e,f.methods=l,f.identity=h,f.isArguments=c,f.isArray=H,f.isEqual=p,f.isFunction=s,f.isObject=y,f.isString=function(n){return typeof n=="string"||q.call(n)==x},f.uniqueId=function(n){var t=++d;return(null==n?"":n)+""+t},f.VERSION="1.3.1",typeof define=="function"&&typeof define.amd=="object"&&define.amd&&define("underscore",[],function(){return f})}(this);define("browserutils",{supportHTML5Audio:function(){var testAudio;try{if(window.HTMLAudioElement&&typeof Audio!=="undefined"){testAudio=new Audio;return true}}catch(e){return false}},supportSourceSwappingWithPreload:function(){return/Firefox/i.test(navigator.userAgent)},isMobile:function(type){var uA=window.navigator.userAgent,devices=["mobile","iPhone","iPad","iPod","Android","Skyfire"];return devices.some(function(device){device=new RegExp(device,"i");return device.test(uA)})},canPlayType:function(type){var audio=document.createElement("audio");if(!audio||!audio.canPlayType){return false}else{return audio.canPlayType(type).match(/maybe|probably/i)?true:false}},isNativeHlsSupported:function(){var ua=navigator.userAgent,devices=["iPhone","iPad","iPod"],check,desktopSafari,iOS;check=function(r){return r.test(ua)};desktopSafari=!check(/chrome/i)&&!check(/opera/i)&&check(/safari/i);iOS=devices.some(function(device){return check(new RegExp(device,"i"))});return iOS||desktopSafari}});define("errors",{FLASH_HLS_PLAYLIST_NOT_FOUND:"HLS_PLAYLIST_NOT_FOUND",FLASH_HLS_PLAYLIST_SECURITY_ERROR:"HLS_SECURITY_ERROR",FLASH_HLS_NOT_VALID_PLAYLIST:"HLS_NOT_VALID_PLAYLIST",FLASH_HLS_NO_TS_IN_PLAYLIST:"HLS_NO_TS_IN_PLAYLIST",FLASH_HLS_NO_PLAYLIST_IN_MANIFEST:"HLS_NO_PLAYLIST_IN_MANIFEST",FLASH_HLS_TS_IS_CORRUPT:"HLS_TS_IS_CORRUPT",FLASH_HLS_FLV_TAG_CORRUPT:"HLS_FLV_TAG_CORRUPT",FLASH_HTTP_FILE_NOT_FOUND:"HTTP_FILE_NOT_FOUND",FLASH_RTMP_CONNECT_FAILED:"RTMP_CONNECT_FAILED",FLASH_RTMP_CONNECT_CLOSED:"RTMP_CONNECT_CLOSED",FLASH_RTMP_CANNOT_PLAY_STREAM:"RTMP_CANNOT_PLAY_STREAM",FLASH_PROXY_CANT_LOAD_FLASH:"CANT_LOAD_FLASH",FLASH_PROXY_FLASH_BLOCKED:"FLASH_PROXY_FLASH_BLOCKED",HTML5_AUDIO_ABORTED:"HTML5_AUDIO_ABORTED",HTML5_AUDIO_NETWORK:"HTML5_AUDIO_NETWORK",HTML5_AUDIO_DECODE:"HTML5_AUDIO_DECODE",HTML5_AUDIO_SRC_NOT_SUPPORTED:"HTML5_AUDIO_SRC_NOT_SUPPORTED"});define("vendor/events",["require","exports","module","underscore"],function(require,exports,module){var _=require("underscore");var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==="object"){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest))}}else if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest))}}else{return true}};var triggerEvents=function(events,args){var ev,i=-1,l=events.length;switch(args.length){case 0:while(++i<l){ev=events[i];ev.callback.call(ev.ctx)}return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,args[0]);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,args[0],args[1]);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,args[0],args[1],args[2]);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args)}};var Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments)});once._callback=callback;return this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this}names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context){retain.push(ev)}}}if(!retain.length)delete this._events[name]}}return this},trigger:function(name,args){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this},stopListening:function(obj,name,callback){var listeners=this._listeners;if(!listeners)return this;var deleteListener=!name&&!callback;if(typeof name==="object")callback=this;if(obj)(listeners={})[obj._listenerId]=obj;for(var id in listeners){listeners[id].off(name,callback,this);if(deleteListener)delete this._listeners[id]}return this}};var listenMethods={listenTo:"on",listenToOnce:"once"};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeners=this._listeners||(this._listeners={});var id=obj._listenerId||(obj._listenerId=_.uniqueId("l"));listeners[id]=obj;if(typeof name==="object")callback=this;obj[implementation](name,callback,this);return this}});Events.bind=Events.on;Events.unbind=Events.off;module.exports=Events});define("states",{PLAYING:"playing",LOADING:"loading",SEEKING:"seeking",PAUSED:"paused",ERROR:"error",IDLE:"idle",INITIALIZE:"initialize",ENDED:"ended",DEAD:"dead"});define("logger",["require","exports","module"],function(require,exports,module){var Logger;module.exports=Logger=function(type,id,settings){this.enabled=settings.debug;this.type=type;this.id=id};Logger.prototype.log=function(message){if(!this.enabled){return}window.console.log("#"+this.type+" "+this.id+"# "+message)}});define("html5audioplayer",["require","exports","module","underscore","vendor/events","states","errors","logger"],function(require,exports,module){var HTML5AudioPlayer,_=require("underscore"),Events=require("vendor/events"),States=require("states"),Errors=require("errors"),Logger=require("logger");module.exports=HTML5AudioPlayer=function(descriptor,settings){this._id=descriptor.id;this._descriptor=descriptor;this._isLoaded=false;this._settings=settings;this._bufferingTimeout=null;this._currentPosition=0;this._loadedPosition=0;this._prevCurrentPosition=0;this._prevCheckTime=0;this._prevComparison=0;this._positionUpdateTimer=0;this._playRequested=false;if(descriptor.duration){this._duration=descriptor.duration}_.bindAll(this,"_onPositionChange","_onStateChange","_onLoaded","_onBuffering");this._init();this.toggleEventListeners(true);if(this._descriptor.preload){this.preload()}if(descriptor.autoPlay){this.play()}else{this._setState(States.IDLE)}};_.extend(HTML5AudioPlayer.prototype,Events);HTML5AudioPlayer.prototype._init=function(){this._html5Audio=new Audio;this._html5Audio.id=this._settings.audioObjectID+"_"+this._descriptor.id;this._html5Audio.preload="none";this._logger=new Logger(this.getType(),this._id,this._settings)};HTML5AudioPlayer.prototype.getId=function(){return this._id};HTML5AudioPlayer.prototype.getType=function(){return"HTML5 audio"};HTML5AudioPlayer.prototype.play=function(position){if(this.isInOneOfStates(States.ERROR,States.DEAD)){return}if(this.isInOneOfStates(States.PAUSED,States.ENDED)){this.resume();return}this._logger.log("play");position=position||0;this._setState(States.LOADING);this._playRequested=true;var playAfterLoaded=function(){if(!this._playRequested){return}this._logger.log("play after loaded");if(position>0){this._html5Audio.currentTime=position/1e3}this._html5Audio.play();clearInterval(this._positionUpdateTimer);this._positionUpdateTimer=setInterval(this._onPositionChange,this._settings.updateInterval)};if(this._isLoaded){playAfterLoaded.apply(this)}else{this.preload();this.once("loaded",playAfterLoaded)}};HTML5AudioPlayer.prototype.pause=function(){this._playRequested=false;if(this.isInOneOfStates(States.ERROR,States.DEAD)){return}this._logger.log("pause");this._html5Audio.pause();clearTimeout(this._bufferingTimeout);clearInterval(this._positionUpdateTimer)};HTML5AudioPlayer.prototype.seek=function(position){var canSeek=false,positionSec,seekable=this._html5Audio.seekable,i;if(this.isInOneOfStates(States.ERROR,States.DEAD)){return}if(!this._isLoaded){this.once("loaded",function(){this.seek(position)});return}positionSec=position/1e3;for(i=0;i<seekable.length;i++){if(positionSec<=seekable.end(i)&&positionSec>=seekable.start(i)){canSeek=true;break}}if(!canSeek){return}this._logger.log("seek");this._setState(States.SEEKING);this._html5Audio.currentTime=position/1e3;clearTimeout(this._bufferingTimeout)};HTML5AudioPlayer.prototype.resume=function(){if(this.isInOneOfStates(States.ERROR,States.DEAD)){return}this._logger.log("resume");if(this.getState()===States.PAUSED){this._setState(States.LOADING);this._html5Audio.play(this._html5Audio.currentTime)}else if(this.getState()===States.ENDED){this._setState(States.LOADING);this._html5Audio.play(0)}clearInterval(this._positionUpdateTimer);this._positionUpdateTimer=setInterval(this._onPositionChange,this._settings.updateInterval)};HTML5AudioPlayer.prototype.setVolume=function(value){if(!this._html5Audio){return}this._html5Audio.volume=value};HTML5AudioPlayer.prototype.getVolume=function(){if(!this._html5Audio){return 1}return this._html5Audio.volume};HTML5AudioPlayer.prototype.setMute=function(value){if(!this._html5Audio){return}this._html5Audio.muted=value};HTML5AudioPlayer.prototype.getMute=function(){if(!this._html5Audio){return false}return this._html5Audio.muted};HTML5AudioPlayer.prototype.getState=function(){return this._state};HTML5AudioPlayer.prototype.getCurrentPosition=function(){return this._currentPosition};HTML5AudioPlayer.prototype.getLoadedPosition=function(){return this._loadedPosition};HTML5AudioPlayer.prototype.getDuration=function(){return this._duration};HTML5AudioPlayer.prototype.kill=function(){if(this._state===States.DEAD){return}clearInterval(this._positionUpdateTimer);clearTimeout(this._bufferingTimeout);this._playRequested=false;this.toggleEventListeners(false);this._html5Audio.pause();this._html5Audio.src=null;delete this._html5Audio;this._setState(States.DEAD)};HTML5AudioPlayer.prototype.getErrorMessage=function(){return this._errorMessage};HTML5AudioPlayer.prototype.getErrorID=function(){return this._errorID};HTML5AudioPlayer.prototype.preload=function(){var audio=this._html5Audio;if(audio.preload!=="auto"){this._logger.log("preload");audio.preload="auto";audio.type=this._descriptor.mimeType;audio.src=this._descriptor.src;audio.load()}};HTML5AudioPlayer.prototype._setState=function(state){if(this._state===state){return}this._logger.log('state changed "'+state+'"');this._state=state;this.trigger("stateChange",state,this)};HTML5AudioPlayer.prototype.toggleEventListeners=function(on){if(!this._html5Audio){return}var dosmthEventListener=on?"addEventListener":"removeEventListener";["ended","play","playing","pause","seeking","waiting","seeked","error"].forEach(function(eventType){this._html5Audio[dosmthEventListener](eventType,this._onStateChange)},this);this._html5Audio[dosmthEventListener]("loadedmetadata",this._onLoaded)};HTML5AudioPlayer.prototype.isInOneOfStates=function(){for(var i in arguments){if(arguments[i]===this._state){return true}}return false};HTML5AudioPlayer.prototype.updatePositions=function(){this._currentPosition=this._html5Audio.currentTime*1e3;if(this._html5Audio.seekable.length>0){this._loadedPosition=this._html5Audio.seekable.end(0)*1e3}if(this._duration===0){this._duration=this._html5Audio.duration*1e3}};HTML5AudioPlayer.prototype._onBuffering=function(){this._setState(States.LOADING)};HTML5AudioPlayer.prototype._onLoaded=function(){this._isLoaded=true;this._logger.log("loaded");this.trigger("loaded",this)};HTML5AudioPlayer.prototype._onPositionChange=function(event){this.updatePositions();this.trigger("positionChange",this._currentPosition,this._loadedPosition,this._duration,this);if(!this.isInOneOfStates(States.PLAYING,States.LOADING)){return}var now=(new Date).valueOf(),positionDelta=this._currentPosition-this._prevCurrentPosition,realTimeDelta=now-this._prevCheckTime,comparison;if(realTimeDelta===0){return}comparison=positionDelta/realTimeDelta;if(comparison>.7){clearTimeout(this._bufferingTimeout);this._setState(States.PLAYING);this._bufferingTimeout=null}else if(this._state===States.PLAYING&&this._bufferingTimeout==null){this._bufferingTimeout=setTimeout(this._onBuffering,this._settings.bufferingDelay)}this._prevCurrentPosition=this._currentPosition;this._prevCheckTime=now};HTML5AudioPlayer.prototype._onStateChange=function(event){this._logger.log('html5 audio event "'+event.type+'"');clearTimeout(this._bufferingTimeout);switch(event.type){case"playing":this.updatePositions();this._setState(States.PLAYING);break;case"pause":this._setState(States.PAUSED);break;case"ended":this._currentPosition=this._loadedPosition=this._duration;this.trigger("positionChange",this._currentPosition,this._loadedPosition,this._duration,this);this._setState(States.ENDED);clearInterval(this._positionUpdateTimer);break;case"waiting":this._setState(States.LOADING);break;case"seeking":this._setState(States.SEEKING);break;case"seeked":this.updatePositions();if(this._html5Audio.paused){this._setState(States.PAUSED)}else{this._setState(States.PLAYING)}break;case"error":this._errorID={1:Errors.HTML5_AUDIO_ABORTED,2:Errors.HTML5_AUDIO_NETWORK,3:Errors.HTML5_AUDIO_DECODE,4:Errors.HTML5_AUDIO_SRC_NOT_SUPPORTED}[this._html5Audio.error.code];this._errorMessage=this._getErrorMessage(this._errorID);this._logger.log("html5 audio error: "+this._errorID+" "+this._errorMessage);this._setState(States.ERROR);this.toggleEventListeners(false);break}};HTML5AudioPlayer.prototype._getErrorMessage=function(errorID){var messages={};messages[Errors.HTML5_AUDIO_ABORTED]="The fetching process was aborted by the user.";messages[Errors.HTML5_AUDIO_NETWORK]="A network connection lost.";messages[Errors.HTML5_AUDIO_DECODE]="An error occurred while decoding the media resource.";messages[Errors.HTML5_AUDIO_SRC_NOT_SUPPORTED]="The media resource is not suitable.";return messages[errorID]}});define("hlsaudioplayer",["require","exports","module","underscore","errors","vendor/events","html5audioplayer","logger","states"],function(require,exports,module){var HLSAudioPlayer,_=require("underscore"),Errors=require("errors"),Events=require("vendor/events"),HTML5AudioPlayer=require("html5audioplayer"),Logger=require("logger"),States=require("states");module.exports=HLSAudioPlayer=function(descriptor,settings){HTML5AudioPlayer.apply(this,arguments);this._seekPosition=0};_.extend(HLSAudioPlayer.prototype,HTML5AudioPlayer.prototype);HLSAudioPlayer.prototype.getType=function(){return"HTML5 HLS audio"};HLSAudioPlayer.prototype.seek=function(position){HTML5AudioPlayer.prototype.seek.apply(this,arguments);if(this.isInOneOfStates(States.LOADING)){this._seekPosition=position}};HLSAudioPlayer.prototype.getCurrentPosition=function(){if(this.isInOneOfStates(States.LOADING)&&this._seekPosition>0){return this._seekPosition}return HTML5AudioPlayer.prototype.getCurrentPosition.apply(this,arguments)};HLSAudioPlayer.prototype._onStateChange=function(event){this._logger.log('hls html5 audio event "'+event.type+'"');clearTimeout(this._bufferingTimeout);switch(event.type){case"playing":this.updatePositions();this._seekPosition=0;this._setState(States.PLAYING);break;case"pause":this._setState(States.PAUSED);break;case"ended":this._currentPosition=this._loadedPosition=this._duration;this.trigger("positionChange",this._currentPosition,this._loadedPosition,this._duration,this);this._setState(States.ENDED);clearInterval(this._positionUpdateTimer);break;case"waiting":this._setState(States.LOADING);break;case"seeking":this._setState(States.SEEKING);break;case"seeked":this.updatePositions();if(this._html5Audio.paused){this._setState(States.PAUSED)}break;case"error":this._errorID={1:Errors.HTML5_AUDIO_ABORTED,2:Errors.HTML5_AUDIO_NETWORK,3:Errors.HTML5_AUDIO_DECODE,4:Errors.HTML5_AUDIO_SRC_NOT_SUPPORTED}[this._html5Audio.error.code];this._errorMessage=this._getErrorMessage(this._errorID);this._logger.log("html5 audio error: "+this._errorID+" "+this._errorMessage);this._setState(States.ERROR);this.toggleEventListeners(false);break}}});define("singleaudioplayer",["require","exports","module","underscore","browserutils","errors","vendor/events","html5audioplayer","logger","states"],function(require,exports,module){var SingleAudioPlayer,_=require("underscore"),BrowserUtils=require("browserutils"),Errors=require("errors"),Events=require("vendor/events"),HTML5AudioPlayer=require("html5audioplayer"),Logger=require("logger"),States=require("states");module.exports=SingleAudioPlayer=function(descriptor,settings){HTML5AudioPlayer.apply(this,arguments)};_.extend(SingleAudioPlayer.prototype,HTML5AudioPlayer.prototype);SingleAudioPlayer.prototype._init=function(){if(!SingleAudioPlayer._html5Audio){var audioObj=new Audio;audioObj.id=this._settings.audioObjectID+"_Single";audioObj.preload="none";SingleAudioPlayer._html5Audio=audioObj;this._preloadAudio=audioObj}this._html5Audio=SingleAudioPlayer._html5Audio;this._playRequested=false;this._logger=new Logger(this.getType(),this._id,this._settings)};SingleAudioPlayer.prototype.getType=function(){return"HTML5 single audio"};SingleAudioPlayer.prototype.play=function(position){this._playRequested=true;if(this._html5Audio._playerId===this._descriptor.id){HTML5AudioPlayer.prototype.resume.apply(this,arguments);return}if(this.isInOneOfStates(States.PAUSED)){position=this._currentPosition}this._html5Audio._playerId=this._descriptor.id;this.toggleEventListeners(true);this._setState(States.LOADING);var playAfterLoaded=function(){if(!this._playRequested){return}this._logger.log("play after loaded");if(position>0){this._html5Audio.currentTime=position/1e3}this._html5Audio.play();clearInterval(this._positionUpdateTimer);this._positionUpdateTimer=setInterval(this._onPositionChange,this._settings.updateInterval)};if(this._html5Audio.readyState>0&&this._descriptor.src===this._html5Audio.src){playAfterLoaded.apply(this)}else{this.once("loaded",playAfterLoaded);this._html5Audio.type=this._descriptor.mimeType;this._html5Audio.src=this._descriptor.src;this._html5Audio.preload="auto";this._html5Audio.load()}};SingleAudioPlayer.prototype.pause=function(){this._playRequested=false;if(this.isInOneOfStates(States.ERROR,States.DEAD)){return}this._logger.log("pause");if(this._html5Audio._playerId===this._descriptor.id){this._html5Audio.pause()}else{this.toggleEventListeners(false);this._setState(States.PAUSED)}};SingleAudioPlayer.prototype.seek=function(position){if(this._html5Audio._playerId!==this._descriptor.id){this._currentPosition=position;this.trigger("positionChange",this._currentPosition,this._loadedPosition,this._duration,this);return}HTML5AudioPlayer.prototype.seek.apply(this,arguments)};SingleAudioPlayer.prototype.kill=function(){if(this._state===States.DEAD){return}this._playRequested=false;clearInterval(this._positionUpdateTimer);clearTimeout(this._bufferingTimeout);this.toggleEventListeners(false);this._setState(States.DEAD)};SingleAudioPlayer.prototype.resume=function(){if(this.isInOneOfStates(States.ERROR,States.DEAD)){return}if(this._html5Audio._playerId!==this._descriptor.id){this.play(this._currentPosition);return}HTML5AudioPlayer.prototype.resume.apply(this,arguments)};SingleAudioPlayer.prototype._onLoaded=function(){if(this.preventDefaultHandler()){return}HTML5AudioPlayer.prototype._onLoaded.apply(this,arguments)};SingleAudioPlayer.prototype._onStateChange=function(event){if(this.preventDefaultHandler()){return}HTML5AudioPlayer.prototype._onStateChange.apply(this,arguments)};SingleAudioPlayer.prototype._onPositionChange=function(event){if(this.preventDefaultHandler()){return}HTML5AudioPlayer.prototype._onPositionChange.apply(this,arguments)};SingleAudioPlayer.prototype.preventDefaultHandler=function(){if(this._html5Audio._playerId!==this._descriptor.id){if(this.isInOneOfStates(States.PLAYING,States.LOADING)){this.pause()}return true}return false};SingleAudioPlayer.prototype.preload=function(){if(!this._preloadAudio&&BrowserUtils.supportSourceSwappingWithPreload()){this._preloadAudio=new Audio;this._preloadAudio.preload="none"}var audio=this._preloadAudio;if(audio&&audio.preload!=="auto"){this._logger.log("preload");audio.preload="auto";audio.type=this._descriptor.mimeType;audio.src=this._descriptor.src;audio.load()}}});define("hlssingleaudioplayer",["require","exports","module","underscore","errors","vendor/events","hlsaudioplayer","logger","singleaudioplayer","states"],function(require,exports,module){var HLSSingleAudioPlayer,_=require("underscore"),Errors=require("errors"),Events=require("vendor/events"),HLSAudioPlayer=require("hlsaudioplayer"),Logger=require("logger"),SingleAudioPlayer=require("singleaudioplayer"),States=require("states");module.exports=HLSSingleAudioPlayer=function(descriptor,settings){SingleAudioPlayer.apply(this,arguments)};_.extend(HLSSingleAudioPlayer.prototype,SingleAudioPlayer.prototype);
HLSSingleAudioPlayer.prototype.getType=function(){return"HTML5 HLS single audio"}});define("mimetypes",{AAC:"audio/aac",M3U8:"application/x-mpegURL",MP4:"audio/mp4",MPEG:"audio/mpeg",OGG:"audio/ogg",WAV:"audio/wav",WEBM:"audio/webm",getTypeByExtension:function(extension){var types={mp1:this.MPEG,mp2:this.MPEG,mp3:this.MPEG,mpeg:this.MPEG,mpg:this.MPEG,aac:this.AAC,mp4:this.MP4,ogg:this.OGG,oga:this.OGG,opus:this.OGG,webm:this.WEBM,wav:this.WAV,m3u8:this.M3U8};return types[extension]||null}});define("factory",["require","exports","module","browserutils","hlssingleaudioplayer","mimetypes","singleaudioplayer"],function(require,exports,module){var MobileFactory,BrowserUtils=require("browserutils"),HLSSingleAudioPlayer=require("hlssingleaudioplayer"),MimeTypes=require("mimetypes"),SingleAudioPlayer=require("singleaudioplayer");module.exports=MobileFactory=function(){};MobileFactory.createAudioPlayer=function(descriptor,settings){var audioType,protocol,extension,player;protocol=descriptor.src.split(":")[0];if(protocol==="rtmp"||protocol==="rtmpt"){return null}else{audioType=MobileFactory.getMimeType(descriptor);if(audioType===MimeTypes.M3U8){if(BrowserUtils.isNativeHlsSupported()){player=new HLSSingleAudioPlayer(descriptor,settings)}else{return null}}else if(BrowserUtils.supportHTML5Audio()&&BrowserUtils.canPlayType(audioType)){player=new SingleAudioPlayer(descriptor,settings)}else{return null}}return player};MobileFactory.getMimeType=function(descriptor){if(descriptor.mimeType){return descriptor.mimeType}var extension=descriptor.src.split("?")[0];extension=extension.substring(extension.lastIndexOf(".")+1,extension.length);return MimeTypes.getTypeByExtension(extension)}});define("audiomanager",["require","exports","module","underscore","factory","states","errors","browserutils"],function(require,exports,module){var AudioManager,_=require("underscore"),PlayerFactory=require("factory"),States=require("states"),Errors=require("errors"),BrowserUtils=require("browserutils");module.exports=AudioManager=function(settings){settings=settings||{};this._players={};this._volume=1;this._mute=false;this._settings=_.defaults(settings,AudioManager.defaults)};AudioManager.States=States;AudioManager.Errors=Errors;AudioManager.BrowserUtils=BrowserUtils;AudioManager.defaults={flashAudioPath:"flashAudio.swf",flashLoadTimeout:2e3,flashObjectID:"flashAudioObject",audioObjectID:"html5AudioObject",updateInterval:300,bufferTime:8e3,bufferingDelay:800,debug:false};AudioManager.prototype.getAudioPlayer=function(id){return this._players[id]};AudioManager.prototype.hasAudioPlayer=function(id){return this._players[id]!==undefined};AudioManager.prototype.removeAudioPlayer=function(id){if(this.hasAudioPlayer(id)){delete this._players[id]}};AudioManager.prototype.setVolume=function(volume){volume=Math.min(1,volume);this._volume=Math.max(0,volume);for(var id in this._players){if(this._players.hasOwnProperty(id)){this._players[id].setVolume(this._volume)}}};AudioManager.prototype.getVolume=function(){return this._volume};AudioManager.prototype.setMute=function(value){this._muted=value;for(var id in this._players){if(this._players.hasOwnProperty(id)){this._players[id].setMute(this._muted)}}};AudioManager.prototype.getMute=function(){return this._muted};AudioManager.prototype.createAudioPlayer=function(descriptor){var audioType,protocol,extension;if(!descriptor.id){descriptor.id=Math.floor(Math.random()*1e10).toString()+(new Date).getTime().toString()}if(!descriptor.src){throw new Error("AudioManager: You need to pass a valid src")}if(!this._players[descriptor.id]){this._players[descriptor.id]=PlayerFactory.createAudioPlayer(descriptor,this._settings)}this._players[descriptor.id].setVolume(this._volume);this._players[descriptor.id].setMute(this._muted);this._players[descriptor.id].on("stateChange",this._onStateChange,this);return this._players[descriptor.id]};AudioManager.prototype._onStateChange=function(state,player){if(player.getState()===States.DEAD){this.removeAudioPlayer(player.getId())}}});require(["audiomanager"]);return require("audiomanager")});